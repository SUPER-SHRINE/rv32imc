# RV32IMC エミュレータ

RISC-V (RV32I) 命令セットをターゲットとしたエミュレータの実装です。

1990 年代のゲーム機を模したファンタジーコンソールを作るために開発しました。

## テストバイナリのビルド手順

公式の [riscv-tests](https://github.com/riscv-software-src/riscv-tests) をビルドし、エミュレータで実行可能なバイナリ形式 (`.bin`) を生成します。
ビルド環境として Docker を使用するため、手元のマシンに RISC-V ツールチェーンをインストールする必要はありません。

### 前提条件
- Docker がインストールされ、実行可能であること。

### ビルド実行
リポジトリのルートで以下のスクリプトを実行してください。

```bash
./build_riscv_tests.sh
```

実行後、`tests/bin/` ディレクトリに `rv32ui-p-add.bin` などのバイナリファイルが生成されます。

## エミュレータの実行手順

ビルドしたバイナリを指定してエミュレータを起動します。

```bash
cargo run -- <バイナリファイルのパス>
```

### 実行例
`add` 命令のテストを実行する場合：

```bash
cargo run -- tests/bin/rv32ui-p-add.bin
```

## テスト結果の確認方法

`riscv-tests` の各テストは、実行終了時に特定のレジスタに結果を格納します。
本エミュレータでは実行終了後に `SUCCESS` または `FAILED` を表示し、失敗した場合はレジスタの状態をダンプします。

- **x3 (gp) レジスタ**: 
    - `0x00000001` であればテスト成功です。
    - それ以外の値は、失敗したテストケースの番号等を示します。

### 終了条件について
現在の実装では、最大 1,000,000 ステップ実行するか、あるいはトラップ（`ECALL` 等）が発生した時点で停止します。
実行終了後に表示される `Result: SUCCESS` または `Result: FAILED` を確認してください。
