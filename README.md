# RV32IMC エミュレータ

RISC-V (RV32I) 命令セットをターゲットとしたエミュレータの実装です。

1990 年代のゲーム機を模したファンタジーコンソールを作るために開発しました。

## テストバイナリのビルド手順

公式の [riscv-tests](https://github.com/riscv-software-src/riscv-tests) をビルドし、エミュレータで実行可能なバイナリ形式 (`.bin`) を生成します。
ビルド環境として Docker を使用するため、手元のマシンに RISC-V ツールチェーンをインストールする必要はありません。

### 前提条件
- Docker がインストールされ、実行可能であること。

### ビルド実行
リポジトリのルートで以下のスクリプトを実行してください。

```bash
./build_riscv_tests.sh
```

実行後、`tests/bin/` ディレクトリに `rv32ui-p-add.bin` などのバイナリファイルが生成されます。

## エミュレータの実行手順

ビルドしたバイナリを指定してエミュレータを起動します。

```bash
cargo run -- <バイナリファイルのパス>
```

### 実行例
`add` 命令のテストを実行する場合：

```bash
cargo run -- tests/bin/rv32ui-p-add.bin
```

## テスト結果の確認方法

`riscv-tests` の各テスト（物理メモリ版 `-p-`）は、実行終了時に特定のレジスタに結果を格納します。
本エミュレータでは実行終了後にレジスタの状態をダンプします。

- **x3 (gp) レジスタ**: 
    - `0x00000001` であればテスト成功です。
    - それ以外の値（例: `0x00000002` 以上）は、失敗したテストケースの番号を示します。

### 終了条件について
現在の実装では、簡易的に 10,000 ステップ実行するか、あるいは無限ループを検知した時点で停止します（開発中）。
実行終了後に表示される `Final state` を確認してください。
