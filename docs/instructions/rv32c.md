# RV32C 拡張命令

RV32C は、16ビット長の圧縮命令セットです。

RV32IMC アーキテクチャに絞って実装しているため、現時点では F系 / D系の命令はサポートしません。

## C.ADDI4SPN

C.ADDI4SPN は CIW 形式の命令で、スタックポインタ (x2/sp) にゼロ以外の即値を加算し、結果を `rd'` (x8-x15) に格納します。
この命令は、標準の `ADDI rd, sp, imm` 命令の圧縮版に相当しますが、即値の範囲と書き込み先レジスタに制限があります。

### 命令フォーマット
```
| 15      13 | 12          5 | 4        2 | 1    0 |
|:----------:|:-------------:|:----------:|:------:|
| 000        | nzuimm[9:2]   | rd'        | 00     |
```
- **nzuimm[9:2]**: ゼロ以外の符号なし即値（4バイトアラインメント）
  - ビット構成: `imm[5:4|9:6|2|3]`
- **rd'**: 書き込み先レジスタ (x8-x15)
- **op**: `00` (Quadrants 0)
- **funct3**: `000`

### 動作

```
if nzuimm == 0:
    (予約済み/Reserved)
else:
    x[8 + rd'] = x[2] + nzuimm
```

### 説明

C.ADDI4SPN 命令は、スタックポインタ (`sp`) に 10 ビットの符号なし即値を加算し、その結果をレジスタ `rd'` に格納します。
即値 `nzuimm` は `imm[5:4|9:6|2|3]` の形式でエンコードされ、4 バイト単位（下位 2 ビットは常に 0）で扱われます。
即値の範囲は 4, 8, ..., 1020 です。即値が 0 の場合は予約済みの命令（Reserved）として扱われます。
`rd'` は 3 ビットで指定され、汎用レジスタ `x8` から `x15`（`s0` から `a7` の一部）のいずれかを選択します。

## C.LW

C.LW は CL 形式の命令で、メモリから 32 ビット値をロードし、`rd'` に格納します。
ベースアドレスはレジスタ `rs1'` に即値を加算して決定されます。

### 命令フォーマット
```
| 15      13 | 12      10 | 9        7 | 6    6 | 5    5 | 4    2 | 1    0 |
|:----------:|:----------:|:----------:|:------:|:------:|:------:|:------:|
| 010        | imm[5:3]   | rs1'       | imm[2] | imm[6] | rd'    | 00     |
```
- **imm**: 符号なし即値（4バイトアラインメント、最大 124 バイト）
  - ビット構成: `imm[5:3|2|6]`
- **rs1'**: ベースアドレスレジスタ (x8-x15)
- **rd'**: 書き込み先レジスタ (x8-x15)
- **op**: `00` (Quadrants 0)
- **funct3**: `010`

### 動作

```
addr = x[8 + rs1'] + {25'b0, imm[6:2], 2'b0}
x[8 + rd'] = load_word(addr)
```

### 説明

C.LW 命令は、ベースレジスタ `rs1'` の値に、スケーリングされた符号なし即値を加算して実効アドレスを計算します。
即値は 5 ビットで構成されますが、下位 2 ビットを 0 と見なす（4 バイトアラインメント）ため、実質的には 7 ビットのオフセット（0 から 124 バイト）として機能します。
計算されたアドレスから 4 バイト（ワード）を読み込み、レジスタ `rd'` に書き込みます。
`rs1'` および `rd'` は 3 ビットで指定され、汎用レジスタ `x8` から `x15`（`s0` から `a7` の一部）のいずれかを選択します。
